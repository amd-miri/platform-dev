<?php
/**
 * @file
 * Code for the reps migrate module.
 */

/**
 * Implements hook_migrate_api().
 */
function newsroom_migrate_migrate_api() {
  $api = array(
    'api' => 2,
    'groups' => array(
      'newsroom_migrate' => array(
        'title' => t('Newsroom imports'),
      ),
    ),

    'migrations' => array(
      'NewsroomTopic' => array(
        'class_name' => 'NewsroomTopicMigration',
        'group_name' => 'newsroom_migrate',
      ),
      'NewsroomType' => array(
        'class_name' => 'NewsroomTypeMigration',
        'group_name' => 'newsroom_migrate',
      ),
      'NewsroomService' => array(
        'class_name' => 'NewsroomServiceMigration',
        'group_name' => 'newsroom_migrate',
      ),
      'NewsroomItem' => array(
        'class_name' => 'NewsroomItemMigration',
        'group_name' => 'newsroom_migrate',
      ),
    ),
  );

  return $api;
}

/**
 * An helper function to update the newsroom_item ct and its fields.
 */
function _newsroom_migrate_update_fields() {
  variable_set('language_content_type_newsroom_item', '4');
  title_field_replacement_toggle('node', 'newsroom_item', 'title');
  $fields = field_info_instances('node', 'newsroom_item');
  foreach ($fields as $field_name => $field_value) {
    $field = field_read_field($field_name);
    $field['translatable'] = 1;
    field_update_field($field);
  }
}

/**
 * Add system languages.
 *
 * @param array $languages
 *   Array of languages codes.
 */
function _newsroom_migrate_add_languages($languages = array()) {
  // Enabling languages.
  if (module_exists('locale')) {
    include_once DRUPAL_ROOT . '/includes/locale.inc';
    if (!empty($languages)) {
      foreach ($languages as $lang) {
        locale_add_language($lang);
      }
    }
  }
}